((core,w,d,reff)=>{"use strict";(register=>{register.register(register)})({register:register=>{var a;a={a:()=>core.utils.debugPrint("INFO","Starting apps..."),b:()=>core.utils.registrar(register),c:()=>core.events.windoc.ready()},(core=register).utils.activator.c(a)},ui:{toolbarButtons:()=>({btnAdd:{text:"New Rent Transactions",icon:"bi-box-fill",attributes:{title:"Create a new rent transaction."},event:()=>{$.ajax({method:"GET",url:`${reff.curl}/availlockerstorent`,contentType:"application/json"}).fail((a,b,c)=>{core.utils.confirmModal({bgColor:"danger white-text",title:"Loading Lockers Failure",message:a.responseText,yesButton:{text:"OK"}})}).done(r=>{$("div#form-alert-container").hide(0),$("#txtPassword").val("");let tgt=$("#selectLocker"),iHtml="";void 0!==r&&r.length>0&&r.forEach((v,i)=>{iHtml+=`<option value="${v.id}">${v.number}</option>`}),tgt.html(iHtml),$.ajax({method:"GET",url:`${window.location.origin}/api/customers`,contentType:"application/json",data:JSON.stringify({limit:1e6})}).fail((a,b,c)=>{core.utils.confirmModal({bgColor:"danger white-text",title:"Loading Customers Failure",message:a.responseText,yesButton:{text:"OK"}})}).done(r=>{let tgt=$("#selectCustomer"),iHtml="";void 0!==r&&r.total>0&&r.rows.forEach((v,i)=>{iHtml+=`<option value="${v.id}">${v.name}</option>`}),tgt.html(iHtml),reff.dom.newRentModal.show()})})}}}),grid:{formatter:{email:(v,r)=>`<a href="mailto:${v.toLowerCase()}">${v}</a>`,date:(v,r,i)=>new Intl.DateTimeFormat("id-ID",{dateStyle:"long"}).format(core.utils.toDate(r.rentDate)),money:(v,r)=>core.utils.IDRFormatter(v),totalDays:(v,r,i)=>{let diff=core.utils.diffDays(new Date,core.utils.toDate(r.rentDate))-1;return diff>=0?`${diff} Days`:""},actions:(v,r,i)=>`<a href="javascript:void(0)" class="icon-row-edit btn btn-sm btn-outline-primary" data-row-id="${r.id}" title="Edit"><i class="bi bi-dropbox"></i></a>`,footer:{label:()=>"Total",rented:data=>data.reduce((n,{totalActiveRent:totalActiveRent})=>n+totalActiveRent,0),returned:data=>data.reduce((n,{totalReturned:totalReturned})=>n+totalReturned,0),trans:data=>data.reduce((n,{totalRentTrans:totalRentTrans})=>n+totalRentTrans,0),fine:data=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(data.reduce((n,{totalPaidFine:totalPaidFine})=>n+totalPaidFine,0))},details:(i,r,e)=>{let tblId=`tbl_for_row_${r.customerId}`;$(e).html($("#detailTable").clone(!0).attr("id",tblId).show()),$(`#${tblId}`).bootstrapTable({classes:"table table-bordered table-hover table-striped table-sm",url:`${reff.curl}/${r.customerId}`,columns:[{field:"id",title:"ID",visible:!1},{field:"lockerId",title:"Locker ID",visible:!1},{field:"number",title:"Locker Number"},{field:"rentDate",title:"Rent Date",formatter:lawencon.ui.grid.formatter.date},{title:"Total Days",width:200,formatter:lawencon.ui.grid.formatter.totalDays},{title:"Actions",width:200,align:"center",formatter:lawencon.ui.grid.formatter.actions,events:lawencon.events.grid.actions}]})}},style:{rented:(v,r,i)=>r.totalActiveRent>=3?{css:{"background-color":"#f8d7da"}}:r.totalActiveRent>=2?{css:{"background-color":"#ffe69c"}}:{css:{"background-color":"#a6e9d5"}}}},modal:{editor:()=>{reff.dom.modal=bootstrap.Modal.getOrCreateInstance(document.getElementById("editorModal")),reff.dom.newRentModal=bootstrap.Modal.getOrCreateInstance(document.getElementById("rentNewModal"))}}},events:{windoc:{ready:()=>$(d).ready(()=>{var a;a={a:()=>core.ui.modal.editor(),b:()=>core.events.form.submitUnlock(),c:()=>core.events.form.submitNew()},core.utils.activator.c(a)})},grid:{actions:{"click .icon-row-edit":(e,v,r,i)=>{let days=core.ui.grid.formatter.totalDays(null,r,null),iDay=parseInt(days),calcFine=({ttlDay:ttlDay,isForgotPassword:isForgotPassword})=>(ttlDay<2?0:5e3*(ttlDay-1))+(isForgotPassword?25e3:0),alertMsg=fine=>1e4>=fine?0==1e4-fine?"The deposit money is <strong>non-refundable</strong> because it has been used entirely for payment of fines.":`Return the deposit of <strong>${core.utils.IDRFormatter(1e4-fine)}</strong> to the customer.`:`Charge an additional fee of <strong>${core.utils.IDRFormatter(fine-1e4)}</strong> as a fine.`;core.utils.setFormOpenLocker({id:r.id,number:r.number,days:days,fine:core.utils.IDRFormatter(calcFine({ttlDay:iDay,isForgotPassword:!1})),cb:()=>{reff.dom.modal.show(),core.utils.showFormAlert({text:alertMsg(calcFine({ttlDay:iDay,isForgotPassword:!1})),color:"success"}),$("input#chkForgotPassword").off("change").on("change",(function(){let txtPwd=$("input#txtPassword");txtPwd.val(""),this.checked?txtPwd.attr("readonly","readonly"):txtPwd.removeAttr("readonly");let calculatedFine=calcFine({ttlDay:iDay,isForgotPassword:this.checked});$("input#txtTotalFine").val(core.utils.IDRFormatter(calculatedFine)),core.utils.showFormAlert({text:alertMsg(calculatedFine),color:"success"})}))}})}}},form:{submitUnlock:()=>$("form#editorForm").submit(e=>{e.preventDefault();let cData={id:$("#txtId").val(),password:$("#txtPassword").val(),totalFine:parseInt($("#txtTotalFine").val().replace(/[^0-9]+/g,"")),isForgotPassword:$("#chkForgotPassword").prop("checked")};cData.isForgotPassword||""!==cData.password?$.ajax({method:"PUT",url:reff.curl,contentType:"application/json",data:JSON.stringify(cData)}).fail((a,b,c)=>core.utils.showFormAlert({text:a.responseText,color:"danger",autoHide:!0})).done(r=>{$("#table").bootstrapTable("refresh"),reff.dom.modal.hide()}):core.utils.showFormAlert({text:"Please fill password field, or tick on Forgot password field.",color:"danger",autoHide:!0})}),submitNew:()=>$("form#RentNewForm").submit(e=>{e.preventDefault();let cData={customerId:$("#selectCustomer option:selected").val(),lockerId:$("#selectLocker option:selected").val()};$.ajax({method:"POST",url:reff.curl,contentType:"application/json",data:JSON.stringify(cData)}).fail((a,b,c)=>core.utils.showFormAlert({text:a.responseText,color:"danger",autoHide:!0})).done(r=>{$("#table").bootstrapTable("refresh"),reff.dom.newRentModal.hide()})})}},utils:{registrar:()=>{w[reff.registrarNamespace]=core,delete w[reff.registrarNamespace].register,delete w[reff.registrarNamespace].utils.registrar},activator:{a:(events,root)=>events.split("|").forEach(a=>root[a]()),b:(events,root)=>events.split("|").forEach(a=>root[a].register()),c:root=>{for(let item in root)root.hasOwnProperty(item)&&"register"!==item&&"function"==typeof root[item]&&root[item]()},d:function(events,root){"0|1".split("|").forEach(x=>delete arguments[x]);const argues=[];for(let i in arguments)arguments.hasOwnProperty(i)&&argues.push(arguments[i]);events.split("|").forEach(x=>root[x].apply(root,argues))},e:function(root){delete arguments[0];const argues=[];for(let i in arguments)arguments.hasOwnProperty(i)&&argues.push(arguments[i]);for(let i in root)root.hasOwnProperty(i)&&"register"!==i&&"function"==typeof root[i]&&root[i].apply(root,argues)}},doNothing:()=>{},isValidData:data=>Array.isArray(data)?data.length>0:data&&"object"==typeof data?!(0===Object.keys(data).length&&data.constructor===Object):null!=data&&""!==data,reEvent:({target:target,event:event,func:func})=>{const ivd=core.utils.isValidData;ivd(target)&&ivd(event)&&ivd(func)&&"function"==typeof func&&(target=$(target)).off(event).on(event,func)},debugPrint:function(session){if(!1===reff.debugMode||arguments.length<1)return;delete arguments[0];const sty="color: black; font-style: italic; font-weight: bold; font-size: 120%; background-color: #a2caee; padding: 0 120px 0 120px;",argues=[];for(let i in arguments)arguments.hasOwnProperty(i)&&argues.push(arguments[i]);0===argues.length&&argues.push("PASS"),console.info(`%c[BOF:: ${session}]`,sty),console.group("[DATA]"),argues.forEach(x=>console.log(x)),console.groupEnd(),console.info(`%c[EOF:: ${session}]`,sty)},confirmModal:({title:title,message:message,yesButton:yesButton,noButton:noButton,bgColor:bgColor})=>{let noBtn="";void 0!==noButton&&noButton.hasOwnProperty("text")&&(noBtn=`<button type="button" class="btn btn-lg btn-secondary close" data-bs-dismiss="modal"><strong>${noButton.text}</strong></button>`),bgColor=bgColor||"white text-dark";let confirm=$(['<div class="modal fade" id="confirmBox" data-bs-backdrop="static" data-bs-keyboard="true" tabindex="-1" aria-labelledby="editorModalLabel" aria-hidden="true">',`<div class="modal-dialog modal-dialog-centered" id="waitDialog"><div class="modal-content"><div class="modal-header bg-${bgColor}">`,`<h5 class="modal-title" id="staticBackdropLabel"><strong>${title}</strong></h5>`,'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>',`</div><div class="modal-body">${message}</div><div class="modal-footer">${noBtn}`,`<button type="button" class="btn btn-${bgColor} btn-lg confirmButton"><strong>${yesButton.text}</strong></button>`,"</div></div></div></div>"].join(""));$("body").append(confirm);let myModal=bootstrap.Modal.getOrCreateInstance(document.getElementById("confirmBox"));myModal.show(),confirm.find("button.confirmButton").one("click",(function(){yesButton.cb&&yesButton.cb(),myModal.hide()})),confirm.find("button.close").one("click",(function(){noButton.cb&&noButton.cb(),myModal.hide()})),confirm.one("hidden.bs.modal",(function(){confirm.remove()}))},setFormOpenLocker:({id:id,number:number,days:days,fine:fine,cb:cb})=>{$("input#txtId").val(id),$("input#txtLockerNumber").val(number),$("input#txtTotalDays").val(days),$("input#txtTotalFine").val(fine),$("input#txtPassword").removeAttr("readonly"),$("input#chkForgotPassword").prop("checked",!1),cb&&cb()},setForm:({id:id,number:number,cb:cb})=>{$("input#txtId").val(id),$("input#txtNumber").val(number),cb&&cb()},getForm:()=>({id:$("input#txtId").val(),number:$("input#txtNumber").val()}),showFormAlert:({text:text,color:color="danger",autoHide:autoHide=!1,cb:cb})=>{$("div#form-alert-container").html(`<div class="alert alert-${color} form-alert" role="alert">${text}</div>`).fadeOut(50).fadeIn(750),autoHide&&setTimeout(()=>{$("div#form-alert-container").fadeOut(750)},5e3),cb&&cb()},toDate:dateStr=>{const[year,month,day]=dateStr.split("-");return new Date(year,month-1,day)},diffDays:(date_1,date_2)=>Math.ceil((date_1.getTime()-date_2.getTime())/864e5),IDRFormatter:v=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0,minimumFractionDigits:0}).format(v)}})})(null,window,document,{debugMode:!0,registrarNamespace:"lawencon",curl:`${window.location.origin}/api/rentals`,dom:{modal:null,newRentModal:null}});